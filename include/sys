/* vim: set ft=cpp: */
#pragma once

#include <prelude>

template<typename T>
auto alloc(usize capacity) -> T*
{
	return reinterpret_cast<T*>(new u8[capacity * sizeof(T)]);
}

template<typename T>
auto realloc(T* old_ptr, usize old_capacity, usize new_capacity) -> T*
{
	for(int i = new_capacity; i < old_capacity; i++)
	{
		old_ptr[i].~T();
	}

	T* new_ptr = reinterpret_cast<T*>(new u8[new_capacity * sizeof(T)]);

	memcpy(new_ptr, old_ptr, new_capacity);

	delete[] reinterpret_cast<u8*>(old_ptr);

	return new_ptr;
}

template<typename T>
auto dealloc(T* ptr, usize capacity) {
	for(int i = 0; i < capacity; i++)
	{
		ptr[i].~T();
	}

	delete[] reinterpret_cast<u8*>(ptr);
}

auto memcpy(dst: u8*, src: u8*, bytes: usize)
{
	for(int i = 0; i < bytes; i++)
	{
		dst[i] = src[i];
	}
}
